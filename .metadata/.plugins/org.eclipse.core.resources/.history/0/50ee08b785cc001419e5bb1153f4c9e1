<!-- BikeDealer BPEL Process [Generated by the Eclipse BPEL Designer] -->
<!-- Date: Tue Mar 17 09:34:30 CET 2015 -->
<bpel:process name="BikeDealer"
         targetNamespace="http://bikeDealer/dealer/"
         suppressJoinFailure="yes"
         xmlns:tns="http://bikeDealer/dealer/"
         xmlns:bpel="http://docs.oasis-open.org/wsbpel/2.0/process/executable"
         xmlns:bk="http://bikeDealer/bike/"
		 xmlns:off="http://bikeDealer/offer/"
		 xmlns:cb="http://bikeDealer/offerCallback/" 
         >
         
    <!-- Import the client WSDL -->
	<bpel:import location="bike.wsdl" namespace="http://bikeDealer/bike/" 
	        importType="http://schemas.xmlsoap.org/wsdl/" />
	<bpel:import location="offerCallback.wsdl" namespace="http://bikeDealer/offerCallback/" 
	        importType="http://schemas.xmlsoap.org/wsdl/" />
	        
	<!--  Import server WSDL -->
	<bpel:import location="offer.wsdl" namespace="http://bikeDealer/offer/" 
	        importType="http://schemas.xmlsoap.org/wsdl/" />
	<bpel:import location="bikeDealer-0.wsdl" namespace="http://bikeDealer/dealer/" 
	        importType="http://schemas.xmlsoap.org/wsdl/" />
	        
	<bpel:partnerLinks>
		<bpel:partnerLink name="bike" partnerLinkType="tns:Bike" partnerRole="directory"/>
		<bpel:partnerLink name="offer" partnerLinkType="tns:Offer" myRole="acceptor" partnerRole="manager"/>
		<bpel:partnerLink name="dealer" partnerLinkType="tns:BikeDealer" myRole="dealer"/>
	</bpel:partnerLinks>
    <!-- ================================================================= -->         
    <!-- ORCHESTRATION LOGIC                                               -->
    <!-- Set of activities coordinating the flow of messages across the    -->
    <!-- services integrated within this business process                  -->
    <!-- ================================================================= -->    
    
    <bpel:variables>
    	<bpel:variable name="offer" messageType="tns:UserOfferRequest"/>
    	<bpel:variable name="ownerIDReq" messageType="bk:getOwnerIDRequest"/>
    	<bpel:variable name="ownerID" messageType="bk:getOwnerIDResponse"/>
    	<bpel:variable name="callBackReq" messageType="cb:ReceiveCallBackRequest"/>
    	<bpel:variable name="offerResp" messageType="tns:UserOfferResponse"/>
    	<bpel:variable name="offerReq" messageType="off:receiveOfferRequest"/>
    </bpel:variables>
         
	<bpel:sequence name="main">
        <bpel:receive name="Receive" partnerLink="dealer" operation="userOffer" variable="offer"></bpel:receive>
        
        <bpel:invoke name="Invoke" partnerLink="bike" operation="getOwnerID" inputVariable="ownerIDReq" outputVariable="ownerID"></bpel:invoke>
        <bpel:invoke name="Invoke1" partnerLink="offer" operation="receiveCallBack" inputVariable="offerResp"></bpel:invoke>
        <bpel:receive name="Receive1" partnerLink="offer" operation="receiveCallBack" variable="callBackReq"></bpel:receive>
        <bpel:reply name="Reply" partnerLink="dealer" operation="userOffer" variable="offerResp"></bpel:reply>
    </bpel:sequence>    
</bpel:process>

