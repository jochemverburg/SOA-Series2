<!-- PatientTreatmentFlow BPEL Process [Generated by the Eclipse BPEL Designer] -->
<!-- Date: Wed Apr 01 13:55:18 CEST 2015 -->
<bpel:process name="PatientTreatmentFlow"
         targetNamespace="http://www.PAHospital.org/WardService/"
         suppressJoinFailure="yes"
         xmlns:tns="http://www.PAHospital.org/WardService/"
         xmlns:bpel="http://docs.oasis-open.org/wsbpel/2.0/process/executable"
         xmlns:labcb="http://www.PAHospital.org/LabCallbackService/"
         xmlns:lab="http://www.PAHospital.org/LabService/"
         xmlns:pat="http://www.PAHospital.org/PatService/"
         xmlns:radcb="http://www.PAHospital.org/RadiologyCallbackService/"
         xmlns:rad="http://www.PAHospital.org/RadiologyService/"
         xmlns:transp="http://www.PAHospital.org/TransportationService/"
         >
         
    <!-- Import the client WSDL -->
	<bpel:import location="WardService.wsdl" namespace="http://www.PAHospital.org/WardService/" 
	        importType="http://schemas.xmlsoap.org/wsdl/" />
	<bpel:import location="LabService-callback.wsdl" namespace="http://www.PAHospital.org/LabCallbackService/" 
	        importType="http://schemas.xmlsoap.org/wsdl/" />
	<bpel:import location="LabService.wsdl" namespace="http://www.PAHospital.org/LabService/" 
	        importType="http://schemas.xmlsoap.org/wsdl/" />
	<bpel:import location="PatService.wsdl" namespace="http://www.PAHospital.org/PatService/" 
	        importType="http://schemas.xmlsoap.org/wsdl/" />
	<bpel:import location="RadService-callback.wsdl" namespace="http://www.PAHospital.org/RadiologyCallbackService/" 
	        importType="http://schemas.xmlsoap.org/wsdl/" />
	<bpel:import location="RadService.wsdl" namespace="http://www.PAHospital.org/RadiologyService/" 
	        importType="http://schemas.xmlsoap.org/wsdl/" />
	<bpel:import location="TranspService.wsdl" namespace="http://www.PAHospital.org/TransportationService/" 
	        importType="http://schemas.xmlsoap.org/wsdl/" />

	<bpel:partnerLinks>
		<bpel:partnerLink name="ward" partnerLinkType="tns:Ward" myRole="ward"/>
		<bpel:partnerLink name="lab" partnerLinkType="tns:Lab" myRole="testRequester" partnerRole="testExecutor"/>
		<bpel:partnerLink name="epr" partnerLinkType="tns:Epr" partnerRole="directory"/>
		<bpel:partnerLink name="rad" partnerLinkType="tns:Rad" myRole="radRequester" partnerRole="radExecutor"/>
		<bpel:partnerLink name="transp" partnerLinkType="tns:Transp" partnerRole="transpExecutor"/>
	</bpel:partnerLinks>
    <!-- ================================================================= -->         
    <!-- ORCHESTRATION LOGIC                                               -->
    <!-- Set of activities coordinating the flow of messages across the    -->
    <!-- services integrated within this business process                  -->
    <!-- ================================================================= -->         
	<bpel:variables>
		<bpel:variable name="admRequest" messageType="tns:OrderAdmissionRequest"/>
		<bpel:variable name="admResp" messageType="tns:OrderAdmissionResponse"/>
		<bpel:variable name="labDataReq" messageType="tns:EnterLabTestOrderDataRequest"/>
		<bpel:variable name="radDataReq" messageType="tns:EnterRadiologyOrderDataRequest"/>
		<bpel:variable name="viewReq" messageType="tns:ViewReportsRequest"/>
		<bpel:variable name="viewResp" messageType="tns:ViewReportsResponse"/>
		<bpel:variable name="eprReq" messageType="pat:GetPatientIDsRequest"/>
		<bpel:variable name="eprResp" messageType="pat:GetPatientIDsResponse"/>
    </bpel:variables>
	
	<bpel:sequence name="main">
		
        <bpel:receive name="Receive" partnerLink="ward" operation="OrderAdmission" portType="tns:Ward"></bpel:receive>
        <bpel:assign validate="no" name="Assign">
           
            <bpel:copy>
                <bpel:from><bpel:literal><s0:PatientName xmlns:s0="http://www.PAHospital.org/PatService/" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">s0:PatientName</s0:PatientName>
				</bpel:literal></bpel:from>
                <bpel:to variable="eprReq" part="PatientName"></bpel:to>
            </bpel:copy>
            <bpel:copy>
                <bpel:from part="PatientData" variable="admRequest">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[PatientName]]></bpel:query>
                </bpel:from>
                <bpel:to part="PatientName" variable="eprReq"></bpel:to>
            </bpel:copy>
        </bpel:assign>
        
        <bpel:invoke name="Invoke" partnerLink="epr" operation="GetPatientIDsByName" portType="pat:ElectronicPatientRecord" inputVariable="eprReq" outputVariable="eprResp"></bpel:invoke>
        
    </bpel:sequence>    
</bpel:process>

